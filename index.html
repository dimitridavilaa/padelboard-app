<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PadelBoard - App</title>
    <link rel="stylesheet" href="app.css">
    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
</head>    
<body class="min-h-full bg-gray-50">
    <!-- Contenido Principal -->
    <div class="main-content">
        <!-- Pestaña 1: Configurador -->
        <div id="configurador-tab" class="content-section active">
            <div class="py-8 px-4">
                <div class="max-w-4xl mx-auto">
                    <!-- Header -->
                    <div class="text-center mb-8">
                        <div class="flex items-center justify-center mb-4">
                            <img src="logo_padelboard.png" alt="Logo PadelBoard" class="app-logo">
                        </div>
                        <h1 class="text-3xl font-bold text-white mb-3">Configurador de Partido</h1> 
                        <p class="text-lg text-white opacity-90">Configura tu partido de pádel con todos los detalles. Elige el formato, sistema de puntuación y más.</p>
                    </div>

                    <!-- Formulario Principal -->
                    <div class="bg-white rounded-2xl shadow-xl p-8">
                        <form id="configuracionForm">
                            <!-- Jugadores -->
                            <div class="mb-8">
                                <h2 class="text-3xl font-bold text-gray-800 mb-6 flex items-center justify-center">
                                    Jugadores
                                </h2>
                                <div>

                                    <div class="pair-card mb-4">
                                        <div class="pair-header">
                                            <h3>Pareja 1</h3>
                                        </div>
                                        <div class="pair-body">
                                            <input type="text" id="jugador1" name="jugador1" 
                                                   class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none transition-colors uppercase"
                                                   placeholder="JUGADOR 1">
                                
                                            <input type="text" id="jugador2" name="jugador2" 
                                                   class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none transition-colors uppercase"
                                                   placeholder="JUGADOR 2">
                                        </div>
                                    </div>
                                
                                    <div class="pair-card">
                                        <div class="pair-header">
                                            <h3>Pareja 2</h3>
                                        </div>
                                        <div class="pair-body">
                                            <input type="text" id="jugador3" name="jugador3" 
                                                   class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none transition-colors uppercase"
                                                   placeholder="JUGADOR 3">
                                
                                            <input type="text" id="jugador4" name="jugador4" 
                                                   class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none transition-colors uppercase"
                                                   placeholder="JUGADOR 4">
                                        </div>
                                    </div>
                                
                                </div>

                            <!-- Tipo de Juego -->
                            <div class="mb-8">
                                <h2 class="text-3xl font-bold text-gray-800 mb-6 flex items-center justify-center">
                                    Tipo de Juego
                                </h2>
                                <div class="game-type-summary-card">
                                    <div>
                                        <h3 id="game-type-summary-title">Al mejor de 3</h3>
                                        <p id="game-type-summary-desc">Formato clásico (por defecto)</p>
                                    </div>
                                    <button type="button" class="change-button" onclick="openGameTypeModal()">
                                        Cambiar
                                    </button>
                                </div>

                                <div class="bg-gray-100 rounded-xl p-6 opacity-70 hidden">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <h3 class="font-bold text-lg mb-2 flex items-center">
                                                Juego Personalizado
                                            </h3>
                                            <p class="text-gray-600 text-sm">Elige la cantidad de games (1-8)</p>
                                        </div>
                                        <div class="flex items-center space-x-3">
                                            <label class="text-sm font-medium text-gray-700">Games:</label>
                                            <select id="customGames" onchange="selectCustomGames()" 
                                                    class="px-3 py-2 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none input-disabled"
                                                    disabled>
                                                <option value="">Próximamente</option>
                                                <option value="1">1 game</option>
                                                <option value="2">2 games</option>
                                                <option value="3">3 games</option>
                                                <option value="4">4 games</option>
                                                <option value="5">5 games</option>
                                                <option value="6">6 games</option>
                                                <option value="7">7 games</option>
                                                <option value="8">8 games</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Sistema de Puntuación -->
                            <div class="mb-8">
                                <h2 class="text-3xl font-bold text-gray-800 mb-6 flex items-center justify-center">
                                    Sistema de Puntuación
                                </h2>
                                <div class="segmented-control">
                                    <button type="button" id="scoring-golden" class="segment-button" onclick="selectScoring('golden', this)">
                                        Punto de Oro
                                    </button>
                                    <button type="button" id="scoring-advantage" class="segment-button" disabled style="opacity: 0.5; cursor: not-allowed; background-color: #f3f4f6;">
                                        Con Ventaja (Próximamente)
                                    </button>
                                </div>
                            </div>

                            <!-- Cambio de Lado -->
                            <div class="mb-8">
                                <h2 class="text-3xl font-bold text-gray-800 mb-6 flex items-center justify-center">
                                    Cambio de Lado
                                </h2>
                                <div class="segmented-control">
                                    <button type="button" id="side-odd" class="segment-button" onclick="selectSideChange('odd', this)">
                                        Juegos Impares
                                    </button>
                                    <button type="button" id="side-set" class="segment-button" onclick="selectSideChange('set', this)">
                                        Final de Set
                                    </button>
                                    <button type="button" id="side-none" class="segment-button" onclick="selectSideChange('none', this)">
                                        Sin Cambio
                                    </button>
                                </div>        
                        </div>                

                            <!-- Método de Conteo -->
                            <div class="mb-8 hidden">
                                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center justify-center">
                                    Método de Conteo
                                </h2>
                                <div class="segmented-control">
                                    <button type="button" id="counting-players" class="segment-button" onclick="selectCountingMethod('players', this)">
                                        Modo Jugadores
                                    </button>
                                    <button type="button" id="counting-referee" class="segment-button" onclick="selectCountingMethod('referee', this)">
                                        Modo Árbitro
                                    </button>
                                </div>
                            </div>

                            <!-- Modo Torneo -->
                            <div class="mb-8">
                                
                                <label class="tournament-card">
                                    <input type="checkbox" id="tournamentMode" class="custom-checkbox-input">
                                        <div class="w-full">
                                            <div class="flex items-center">                                                
                                                <h3 class="font-bold text-lg text-gray-800" style="margin-right: 15px; margin-bottom: 18px;">
                                                    Modo Torneo
                                                </h3>                                                
                                                <div class="checkmark-box"></div>
                                            </div>
                                            <p class="text-gray-600 text-xs leading-tight" style="margin-top: -10px;">
                                                Cambio de lado obligatorio en Tie-breaks <br> (cada 6 pts)
                                            </p>
                                        </div>
                                </label>
                            </div>

                            <!-- Botones de Acción -->
                            <div class="flex flex-col sm:flex-row gap-4">
                                <button type="button" onclick="openConfirmModal(event)" 
                                        class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-8 rounded-xl text-lg transition-colors">
                                    Iniciar Partido
                                </button>
                                <button type="button" onclick="resetConfig()" 
                                        class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-4 px-8 rounded-xl text-lg transition-colors">
                                    Reiniciar Configuración
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>


        <!-- Pestaña 2: Estadísticas -->
        <div id="stats-tab" class="content-section">
            <div class="py-8 px-4">
                <div class="max-w-4xl mx-auto">
                    <!-- Header -->
                    <div class="text-center mb-8">
                        <div class="flex items-center justify-center mb-4">
                            <img src="logo_padelboard.png" alt="Logo PadelBoard" class="app-logo">
                        </div>
                        <h1 class="text-3xl font-bold text-white mb-3">Estadísticas de Rendimiento</h1>
                        <p class="text-lg text-white opacity-90">Revisa tu progreso y analiza tu juego. Todas las estadísticas de tus partidos guardados.</p>
                    </div>

                    <!-- Contenido Principal -->
                    <div class="bg-white rounded-2xl shadow-xl p-8">
                        <!-- Contenido sin login -->
                        <div id="stats-no-login" class="text-center py-12">
                            <div class="mb-8">
                                <svg class="mx-auto h-24 w-24 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                                </svg>
                            </div>
                            <h2 class="text-2xl font-bold text-gray-800 mb-6">Inicia sesión para ver tus estadísticas</h2>
                            <p class="text-lg text-gray-600 mb-8">Registra tus partidos y accede a análisis detallados de tu rendimiento. Todas las estadísticas se guardan automáticamente cuando juegas con sesión iniciada.</p>
                            <button onclick="showLoginForm()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-8 rounded-xl text-lg transition-colors">
                                Iniciar Sesión
                            </button>
                        </div>
                        
                        <!-- App Móvil -->
                        <div class="mt-8">
                            <div class="bg-gradient-to-r from-blue-50 to-blue-100 rounded-xl p-6 text-center">
                                <div class="mb-4">
                                    <svg class="w-16 h-16 mx-auto text-blue-600 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                                    </svg>
                                    <h3 class="text-xl font-bold text-blue-800 mb-2">PadelBoard Móvil</h3>
                                    <p class="text-blue-600 mb-6">Lleva tus partidos contigo. Sincroniza automáticamente tus estadísticas.</p>
                                </div>
                                <button onclick="downloadApp()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-xl transition-colors">
                                    Descargar App Móvil
                                </button>
                            </div>
                        </div>

                        <!-- Contenido con login (oculto inicialmente) -->
                        <div id="stats-with-login" class="hidden">
                            <!-- Resumen General -->
                            <div class="mb-8">
                                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center justify-center">
                                    Resumen General
                                </h2>
                                <div class="grid md:grid-cols-2 gap-6">
                                    <div class="bg-gradient-to-r from-blue-50 to-blue-100 rounded-xl p-6 text-center">
                                        <h3 class="text-3xl font-bold text-blue-800 mb-2">24</h3>
                                        <p class="text-blue-600 font-medium">Partidos Jugados</p>
                                    </div>
                                    <div class="bg-gradient-to-r from-blue-50 to-blue-100 rounded-xl p-6 text-center">
                                        <h3 class="text-3xl font-bold text-blue-800 mb-2">67%</h3>
                                        <p class="text-blue-600 font-medium">Porcentaje de Victorias</p>
                                    </div>
                                    <div class="bg-gradient-to-r from-blue-50 to-blue-100 rounded-xl p-6 text-center">
                                        <h3 class="text-3xl font-bold text-blue-800 mb-2">1,247</h3>
                                        <p class="text-blue-600 font-medium">Puntos Totales</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Estadísticas Detalladas -->
                            <div class="mb-8">
                                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center justify-center">
                                    Estadísticas Detalladas
                                </h2>
                                <div class="grid md:grid-cols-2 gap-6">
                                    <div class="bg-white rounded-xl p-6 border-2 border-gray-200">
                                        <h3 class="text-xl font-bold text-gray-800 mb-4">Rendimiento por Set</h3>
                                        <div class="space-y-3">
                                            <div class="flex justify-between items-center">
                                                <span class="text-gray-700">Sets ganados</span>
                                                <span class="font-bold text-blue-600">32</span>
                                            </div>
                                            <div class="flex justify-between items-center">
                                                <span class="text-gray-700">Sets perdidos</span>
                                                <span class="font-bold text-gray-600">16</span>
                                            </div>
                                            <div class="flex justify-between items-center">
                                                <span class="text-gray-700">Porcentaje de sets</span>
                                                <span class="font-bold text-blue-600">67%</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="bg-white rounded-xl p-6 border-2 border-gray-200">
                                        <h3 class="text-xl font-bold text-gray-800 mb-4">Rendimiento por Game</h3>
                                        <div class="space-y-3">
                                            <div class="flex justify-between items-center">
                                                <span class="text-gray-700">Games ganados</span>
                                                <span class="font-bold text-blue-600">156</span>
                                            </div>
                                            <div class="flex justify-between items-center">
                                                <span class="text-gray-700">Games perdidos</span>
                                                <span class="font-bold text-gray-600">98</span>
                                            </div>
                                            <div class="flex justify-between items-center">
                                                <span class="text-gray-700">Porcentaje de games</span>
                                                <span class="font-bold text-blue-600">61%</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Historial de Partidos -->
                            <div class="mb-8">
                                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center justify-center">
                                    Últimos Partidos
                                </h2>
                                <div class="bg-white rounded-xl p-6 border-2 border-gray-200">
                                    <div class="space-y-4">
                                        <div class="flex justify-between items-center p-4 bg-gray-50 rounded-lg">
                                            <div>
                                                <span class="font-bold text-gray-800">Juan & Pedro vs Carlos & Ana</span>
                                                <p class="text-sm text-gray-600">Hace 2 días - Club Deportivo</p>
                                            </div>
                                            <span class="font-bold text-green-600 text-lg">6-4, 6-2</span>
                                        </div>
                                        <div class="flex justify-between items-center p-4 bg-gray-50 rounded-lg">
                                            <div>
                                                <span class="font-bold text-gray-800">María & Luis vs Sofia & Diego</span>
                                                <p class="text-sm text-gray-600">Hace 5 días - Polideportivo Norte</p>
                                            </div>
                                            <span class="font-bold text-red-600 text-lg">4-6, 3-6</span>
                                        </div>
                                        <div class="flex justify-between items-center p-4 bg-gray-50 rounded-lg">
                                            <div>
                                                <span class="font-bold text-gray-800">Alex & Carmen vs Roberto & Elena</span>
                                                <p class="text-sm text-gray-600">Hace 1 semana - Centro Deportivo</p>
                                            </div>
                                            <span class="font-bold text-green-600 text-lg">7-5, 6-4</span>
                                        </div>
                                    </div>
                                </div>
                            </div>



                            <!-- Botón Ver Más -->
                            <div class="text-center">
                                <button onclick="showFullStats()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-8 rounded-xl text-lg transition-colors">
                                    Ver Historial Completo
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pestaña 3: Perfil -->
        <div id="perfil-tab" class="content-section">
            <div class="py-8 px-4">
                <div class="max-w-4xl mx-auto">
                    <!-- Header -->
                    <div class="text-center mb-8">
                        <div class="flex items-center justify-center mb-4">
                            <img src="/logo_padelboard.png" alt="Logo PadelBoard" class="app-logo">
                        </div>
                        <h1 class="text-3xl font-bold text-white mb-3">Gestión de Perfil</h1>
                        <p class="text-lg text-white opacity-90">Administra tu cuenta, configuraciones y preferencias. Inicia sesión para acceder a todas las funciones.</p>
                    </div>

                    <!-- Contenido Principal -->
                    <div class="bg-white rounded-2xl shadow-xl p-8">
                        <!-- Formulario de Login -->
                        <div id="login-form">
                            <div class="text-center mb-8">
                                <h2 class="text-2xl font-bold text-gray-800 mb-4">Iniciar Sesión</h2>
                                <p class="text-gray-600">Accede a tu cuenta para ver estadísticas y configuraciones</p>
                            </div>
                            
                            <form onsubmit="handleLogin(event)" class="max-w-md mx-auto">
                                <div class="mb-6">
                                    <label for="email" class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                    <input type="email" id="email" name="email" required
                                           class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none transition-colors"
                                           placeholder="tu@email.com">
                                </div>
                                
                                <div class="mb-6">
                                    <label for="password" class="block text-sm font-medium text-gray-700 mb-2">Contraseña</label>
                                    <input type="password" id="password" name="password" required
                                           class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none transition-colors"
                                           placeholder="Tu contraseña">
                                </div>
                                
                                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-8 rounded-xl text-lg transition-colors mb-4">
                                    Iniciar Sesión
                                </button>
                                
                                <div class="text-center">
                                    <p class="text-gray-600 mb-4">¿No tienes cuenta?</p>
                                    <button type="button" onclick="showRegisterForm()" class="text-blue-600 hover:text-blue-700 font-medium">
                                        Crear cuenta nueva
                                    </button>
                                </div>
                            </form>
                        </div>

                        <!-- Formulario de Registro -->
                        <div id="register-form" class="hidden">
                            <div class="text-center mb-8">
                                <h2 class="text-2xl font-bold text-gray-800 mb-4">Crear Cuenta</h2>
                                <p class="text-gray-600">Regístrate para guardar tus estadísticas y configuraciones</p>
                            </div>
                            
                            <form onsubmit="handleRegister(event)" class="max-w-md mx-auto">
                                <div class="mb-6">
                                    <label for="reg-name" class="block text-sm font-medium text-gray-700 mb-2">Nombre completo</label>
                                    <input type="text" id="reg-name" name="name" required
                                           class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none transition-colors"
                                           placeholder="Tu nombre completo">
                                </div>
                                
                                <div class="mb-6">
                                    <label for="reg-email" class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                    <input type="email" id="reg-email" name="email" required
                                           class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none transition-colors"
                                           placeholder="tu@email.com">
                                </div>
                                
                                <div class="mb-6">
                                    <label for="reg-password" class="block text-sm font-medium text-gray-700 mb-2">Contraseña</label>
                                    <input type="password" id="reg-password" name="password" required
                                           class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none transition-colors"
                                           placeholder="Mínimo 6 caracteres">
                                </div>
                                
                                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-8 rounded-xl text-lg transition-colors mb-4">
                                    Crear Cuenta
                                </button>
                                
                                <div class="text-center">
                                    <p class="text-gray-600 mb-4">¿Ya tienes cuenta?</p>
                                    <button type="button" onclick="showLoginForm()" class="text-blue-600 hover:text-blue-700 font-medium">
                                        Iniciar sesión
                                    </button>
                                </div>
                            </form>
                        </div>

                        <!-- Contenido sin login (oculto por defecto) -->
                        <div id="profile-no-login" class="hidden">
                            <div class="text-center py-12">
                                <div class="mb-8">
                                    <svg class="mx-auto h-24 w-24 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                    </svg>
                                </div>
                                <h2 class="text-2xl font-bold text-gray-800 mb-6">Inicia sesión para gestionar tu perfil</h2>
                                <p class="text-lg text-gray-600 mb-8">Accede a tu cuenta para personalizar configuraciones, ver tu historial y sincronizar datos con la app móvil.</p>
                                <button onclick="showLoginForm()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-8 rounded-xl text-lg transition-colors">
                                    Iniciar Sesión
                                </button>
                                
                                <!-- App Móvil -->
                                <div class="mt-8">
                                    <div class="bg-gradient-to-r from-blue-50 to-blue-100 rounded-xl p-6 text-center">
                                        <div class="mb-4">
                                            <svg class="w-16 h-16 mx-auto text-blue-600 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                                            </svg>
                                            <h3 class="text-xl font-bold text-blue-800 mb-2">PadelBoard Móvil</h3>
                                            <p class="text-blue-600 mb-6">Lleva tus partidos contigo. Sincroniza automáticamente tus estadísticas.</p>
                                        </div>
                                        <button onclick="downloadApp()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-xl transition-colors">
                                            Descargar App Móvil
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Perfil de usuario (oculto inicialmente) -->
                        <div id="user-profile" class="hidden">
                            <!-- Información del Usuario -->
                            <div class="mb-8">
                                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center justify-center">
                                    Información Personal
                                </h2>
                                <div class="text-center mb-6">
                                    <div class="w-24 h-24 bg-gradient-to-r from-blue-50 to-blue-100 rounded-full mx-auto mb-4 flex items-center justify-center border-4 border-blue-200">
                                        <span class="text-2xl font-bold text-blue-600" id="user-initials">ND</span>
                                    </div>
                                    <h3 class="text-xl font-bold text-gray-800" id="user-name">Nicolas Davila</h3>
                                    <p class="text-gray-600" id="user-email">nicolas.davila@email.com</p>
                                </div>
                            </div>

                            <!-- Configuraciones -->
                            <div class="mb-8">
                                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center justify-center">
                                    Configuraciones
                                </h2>
                                <div class="grid md:grid-cols-2 gap-6">
                                    <div class="bg-gradient-to-r from-blue-50 to-blue-100 rounded-xl p-6">
                                        <h3 class="text-xl font-bold text-blue-800 mb-4 text-center">Preferencias de Juego</h3>
                                        <div class="space-y-4">
                                            <div class="flex justify-between items-center">
                                                <span class="text-gray-700">Formato favorito</span>
                                                <span class="font-bold text-blue-600">Al mejor de 3</span>
                                            </div>
                                            <div class="flex justify-between items-center">
                                                <span class="text-gray-700">Puntuación preferida</span>
                                                <span class="font-bold text-blue-600">Punto de Oro</span>
                                            </div>
                                            <div class="flex justify-between items-center">
                                                <span class="text-gray-700">Cambio de lado</span>
                                                <span class="font-bold text-blue-600">Juegos impares</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="bg-gradient-to-r from-blue-50 to-blue-100 rounded-xl p-6">
                                        <h3 class="text-xl font-bold text-blue-800 mb-4 text-center">Configuración de App</h3>
                                        <div class="space-y-4">
                                            <div class="flex justify-between items-center">
                                                <span class="text-gray-700">Notificaciones</span>
                                                <button class="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-bold">Activadas</button>
                                            </div>
                                            <div class="flex justify-between items-center">
                                                <span class="text-gray-700">Tema de la app</span>
                                                <button class="bg-gray-200 text-gray-700 px-4 py-2 rounded-lg text-sm font-bold">Claro</button>
                                            </div>
                                            <div class="flex justify-between items-center">
                                                <span class="text-gray-700">Idioma</span>
                                                <button class="bg-gray-200 text-gray-700 px-4 py-2 rounded-lg text-sm font-bold">Español</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Descargar App Móvil -->
                            <div class="mb-8">
                                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center justify-center">
                                    App Móvil
                                </h2>
                                <div class="bg-gradient-to-r from-blue-50 to-blue-100 rounded-xl p-6 text-center">
                                    <div class="mb-4">
                                        <svg class="w-16 h-16 mx-auto text-blue-600 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                                        </svg>
                                        <h3 class="text-xl font-bold text-blue-800 mb-2">PadelBoard Móvil</h3>
                                        <p class="text-blue-600 mb-6">Lleva tus partidos contigo. Sincroniza automáticamente tus estadísticas.</p>
                                    </div>
                                    <button onclick="downloadApp()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-xl transition-colors">
                                        Descargar App Móvil
                                    </button>
                                </div>
                            </div>

                            <!-- Acciones -->
                            <div class="space-y-4">
                                <button class="w-full bg-gray-500 hover:bg-gray-600 text-white font-bold py-4 px-8 rounded-xl text-lg transition-colors">
                                    Editar Perfil
                                </button>
                                <button onclick="handleLogout()" 
                                        class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-4 px-8 rounded-xl text-lg transition-colors">
                                    Cerrar Sesión
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Banner de Descarga Inferior -->
    <div id="download-banner" class="bg-blue-600 text-white py-3 px-4 text-center relative hidden" style="position: fixed; bottom: 60px; left: 0; right: 0; z-index: 40;">        <div class="flex items-center justify-center space-x-4">
            <div class="flex items-center space-x-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                </svg>
                <span class="text-sm font-medium">¡Descarga la App Móvil de PadelBoard!</span>
            </div>
            <button onclick="downloadApp()" class="bg-white text-blue-600 px-4 py-1 rounded-full text-sm font-bold hover:bg-gray-100 transition-colors">
                Descargar
            </button>
        </div>
        <button onclick="this.parentElement.style.display='none'" class="absolute right-4 top-1/2 transform -translate-y-1/2 text-white hover:text-gray-200">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
        </button>
    </div>

    <!-- Navegación Inferior -->
    <div class="bottom-nav hidden">
        <div class="flex">
            <button onclick="switchTab('configurador')" id="tab-configurador" 
                    class="flex-1 py-4 px-2 text-center tab-active transition-colors">
                <div class="flex flex-col items-center">
                    <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                    <span class="text-xs font-medium">Configurar</span>
                </div>
            </button>
            <button onclick="switchTab('stats')" id="tab-stats" 
                    class="flex-1 py-4 px-2 text-center tab-inactive transition-colors">
                <div class="flex flex-col items-center">
                    <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                    </svg>
                    <span class="text-xs font-medium">Estadísticas</span>
                </div>
            </button>
            <button onclick="switchTab('perfil')" id="tab-perfil" 
                    class="flex-1 py-4 px-2 text-center tab-inactive transition-colors">
                <div class="flex flex-col items-center">
                    <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                    <span class="text-xs font-medium">Perfil</span>
                </div>
            </button>
        </div>
    </div>

    <div id="gameTypeModal" class="modal-overlay hidden">
        <div class="modal-content">
      
          <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">
              Selecciona un Formato de Juego
          </h2>
      
          <div class="game-type-button-list">
              <button type="button" onclick="selectGameTypeFromModal('3sets', 'Al mejor de 3', 'Formato clásico (por defecto)')">
                  <h3>Al mejor de 3</h3>
                  <p>Partidos estándar (1-3 sets)</p>
              </button>
              <button type="button" onclick="selectGameTypeFromModal('2sets-super', '2 Sets + Super Tie', 'Formato de torneo (tie-break a 10)')">
                <h3>2 Sets + Super Tie</h3>
                <p>Formato de torneo (tie-break a 10)</p>
            </button>
              <button type="button" onclick="selectGameTypeFromModal('1set', '1 Set', 'Partido único')">
                  <h3>1 Set</h3>
                  <p>Un solo set, ideal para partidos rápidos</p>
              </button>
              <button type="button" disabled style="opacity: 0.5; cursor: not-allowed; background-color: #f3f4f6;">
                <h3 style="color: #6b7280;">Solo Tie-break (Próximamente)</h3>
                <p>Gana el primero en llegar a 7 puntos</p>
            </button>
            <button type="button" disabled style="opacity: 0.5; cursor: not-allowed; background-color: #f3f4f6;">
                <h3 style="color: #6b7280;">Super Tie-break (Próximamente)</h3>
                <p>Gana el primero en llegar a 10 puntos</p>
            </button>
            <button type="button" disabled style="opacity: 0.5; cursor: not-allowed; background-color: #f3f4f6;">
                <h3 style="color: #6b7280;">Juego Rápido (Próximamente)</h3>
                <p>Un set corto a 4 games</p>
            </button>
          </div>
      
          <div class="modal-actions">
              <button type="button" onclick="closeGameTypeModal()" 
                      class="w-full bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-xl text-lg transition-colors">
                  Cancelar
              </button>
          </div>
        </div>
      </div>

    <!-- Modal Resumen del Partido -->
    <div id="confirmModal" class="modal-overlay hidden">
        <div class="modal-content">
    
            <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">
                Resumen del Partido
            </h2>
            
            <div id="configSummaryList" class="summary-list">
                
                <div class="summary-group">
                    <h3 class="summary-title">Equipos</h3>
                    <div id="teams-summary" class="summary-details">
                        </div>
                </div>
                
                <div class="summary-group">
                    <h3 class="summary-title">Formato</h3>
                    <div id="format-summary" class="summary-details">
                        </div>
                </div>
            </div>
            
            <div class="modal-actions">
                <button type="button" onclick="closeConfirmModal()" 
                        class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-xl text-lg transition-colors">
                    Cancelar
                </button>
                <button type="button" onclick="startMatch()" 
                        class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-xl text-lg transition-colors">
                    Confirmar e Iniciar
                </button>
            </div>
        
        </div>
    </div>

    <script>
    // ==========================================
    // LÓGICA MQTT (CONEXIÓN A INTERNET)
    // ==========================================
    // LÓGICA DE CANALES DINÁMICOS (SEGURIDAD)
    // ==========================================
    let mqttClient = null;
    let mqttConnected = false;

    // 1. Detectamos qué cancha se quiere controlar leyendo la URL
    const urlParams = new URLSearchParams(window.location.search);
    const COURT_ID = urlParams.get('id'); 

    // SEGURIDAD: Si no hay ID en la URL, usamos 'DEMO'
    // Así evitamos que controlen tu marcador por accidente.
    const targetID = COURT_ID ? COURT_ID : 'DEMO';

    // 2. Configuramos MQTT
    const MQTT_CFG = {
        url: "wss://8710939c545d4dc7adc1804a0bd323fb.s1.eu.hivemq.cloud:8884/mqtt",
        username: "padelboard_pb2",
        password: "Aqeria123",
        // El tópico cambia según lo que diga la URL
        topicConfig: `padelboard/${targetID}/config`
    };

    console.log("ID Objetivo:", targetID);
    
    // (Opcional) Avisar si está en modo demo
    document.addEventListener('DOMContentLoaded', function() {
        if (!COURT_ID) {
            console.warn("⚠️ MODO DEMO: Sin ID de cancha.");
        }
    });

    function mqttConnect() {
        console.log("Iniciando conexión MQTT...");
        try {
            // Conectamos usando la librería que agregamos arriba
            mqttClient = mqtt.connect(MQTT_CFG.url, {
                username: MQTT_CFG.username,
                password: MQTT_CFG.password,
                clean: true,
                clientId: "web-" + Math.random().toString(16).slice(2) // ID único
            });

            mqttClient.on("connect", () => {
                mqttConnected = true;
                console.log("✅ CONECTADO A HIVEMQ (INTERNET)");
            });

            mqttClient.on("error", (e) => {
                console.error("❌ Error MQTT:", e);
                mqttConnected = false;
            });
            
            mqttClient.on("close", () => { mqttConnected = false; });
            
        } catch (e) {
            console.error("Excepción MQTT:", e);
        }
    }

    // Función para enviar el mensaje
    function mqttSendConfig(payloadObj) {
        if (!mqttClient || !mqttConnected) {
            console.log("⚠️ No hay conexión MQTT, intentando reconectar...");
            mqttConnect(); // Intento desesperado de conectar
            return false;
        }
        
        const payload = JSON.stringify(payloadObj);
        mqttClient.publish(MQTT_CFG.topicConfig, payload, { qos: 0, retain: false });
        console.log("📤 Configuración enviada por Internet:", payload);
        return true;
    }

    // ==========================================
    // FIN LÓGICA MQTT
    // ==========================================

        // Variables globales
        // === CAMBIO CLAVE: CONFIGURACIÓN POR DEFECTO ===
        let config = {
            players: {},
            gameType: '3sets',
            scoring: 'golden',
            countingMethod: 'players',
            sideChange: 'set'
        };

        let isLoggedIn = false;
        let currentUser = null;

        // Función de descarga de app
        function downloadApp() {
            const downloadOptions = `
Descarga PadelBoard App

Elige tu plataforma:

📱 iOS (App Store)
🤖 Android (Google Play)
💻 Versión de Escritorio

Beneficios de la app móvil:
• Marcador offline sin conexión a internet
• Sincronización automática de estadísticas
• Notificaciones de partidos programados
• Análisis avanzado de rendimiento
• Interfaz optimizada para móviles

¿En qué dispositivo quieres instalarla?
            `;
            
            if (confirm(downloadOptions)) {
                // Aquí irían los links reales de descarga
                alert('🚀 ¡Genial! Te redirigiremos a la tienda de aplicaciones.\n\n(En la versión real, aquí se abriría el link de descarga correspondiente)');
            }
        }

        // Funciones del configurador
        // === FUNCIONES DE CONFIGURACIÓN MODIFICADAS ===
        // --- NUEVA LÓGICA: Modal "Tipo de Juego" ---
        function openGameTypeModal() {
            document.body.classList.add('modal-open');
            document.getElementById('gameTypeModal').classList.remove('hidden');

            // --- NUEVO: Marcar la selección actual ---
            // 1. Limpiar todas
            document.querySelectorAll('#gameTypeModal .game-type-button-list button').forEach(btn => {
                btn.classList.remove('selected');
            });
            // 2. Encontrar el botón que coincide con la config y marcarlo
            const currentType = config.gameType; // ej: '3sets'
            const currentButton = document.querySelector(`#gameTypeModal button[onclick*="'${currentType}'"]`);
            if (currentButton) {
                currentButton.classList.add('selected');
            }
            // --- FIN DEL CAMBIO ---
        }

        function closeGameTypeModal() {
            document.body.classList.remove('modal-open');
            document.getElementById('gameTypeModal').classList.add('hidden');
        }

        function selectGameTypeFromModal(type, title, desc) {
            // 1. Actualizar la config global
            config.gameType = type;

            // --- NUEVO: Actualizar la selección visual ---
            // 1. Quitar .selected de todos los botones
            document.querySelectorAll('#gameTypeModal .game-type-button-list button').forEach(btn => {
                btn.classList.remove('selected');
            });
            // 2. Añadir .selected al botón clickeado
            // (Usamos un selector de atributos para encontrar el botón correcto)
            event.target.closest('button').classList.add('selected');
            // --- FIN DEL CAMBIO ---

            // 2. Actualizar la tarjeta resumen en la página principal
            document.getElementById('game-type-summary-title').textContent = title;
            document.getElementById('game-type-summary-desc').textContent = desc;

            // 3. Cerrar el modal
            closeGameTypeModal();

            // 4. Actualizar el modal de confirmación
            updateSummary();
        }

        function selectScoring(type, element) {
            // 1. Actualizar la configuración global
            config.scoring = type;

            // 2. Quitar 'selected' de todos los botones hermanos
            const parent = element.parentElement;
            parent.querySelectorAll('.segment-button').forEach(btn => {
                btn.classList.remove('selected');
            });

            // 3. Añadir 'selected' solo al botón clickeado
            element.classList.add('selected');

            // 4. Actualizar el resumen
            updateSummary();
        }

        function selectCountingMethod(type, element) {
            // 1. Actualizar la configuración global
            config.countingMethod = type;

            // 2. Quitar 'selected' de todos los botones hermanos
            const parent = element.parentElement;
            parent.querySelectorAll('.segment-button').forEach(btn => {
                btn.classList.remove('selected');
            });

            // 3. Añadir 'selected' solo al botón clickeado
            element.classList.add('selected');

            // 4. Actualizar el resumen
            updateSummary();
        }

        function selectSideChange(type, element) {
            // 1. Actualizar la configuración global
            config.sideChange = type;

            // 2. Quitar 'selected' de todos los botones hermanos
            const parent = element.parentElement;
            parent.querySelectorAll('.segment-button').forEach(btn => {
                btn.classList.remove('selected');
            });

            // 3. Añadir 'selected' solo al botón clickeado
            element.classList.add('selected');

            // 4. Actualizar el resumen
            updateSummary();
        }

        function selectCustomGames() {
            const customGames = document.getElementById('customGames').value;
            if (customGames) {
                config.gameType = `custom-${customGames}`;
                document.querySelectorAll('.option-card').forEach(card => {
                    if (card.onclick && card.onclick.toString().includes('selectGameType')) {
                        card.classList.remove('selected');
                    }
                });
                updateSummary();
            }
        }

        function updateSummary() {
            const players = {
                jugador1: document.getElementById('jugador1').value || 'Jugador 1',
                jugador2: document.getElementById('jugador2').value || 'Jugador 2',
                jugador3: document.getElementById('jugador3').value || 'Jugador 3',
                jugador4: document.getElementById('jugador4').value || 'Jugador 4'
            };

            const gameTypes = {
                '1set': '1 Set',
                '3sets': 'Al mejor de 3 sets',
                '2sets-super': '2 Sets + Super Tie-break',
                'tiebreak': 'Solo Tie-break (7 puntos)',
                'super-tiebreak': 'Solo Super Tie-break (10 puntos)',
                'quick': 'Juego Rápido (4 games)'
            };

            let gameTypeText = gameTypes[config.gameType] || 'No seleccionado';
            if (config.gameType && config.gameType.startsWith('custom-')) {
                const numGames = config.gameType.split('-')[1];
                gameTypeText = `Personalizado (${numGames} games)`;
            }

            const scoringTypes = {
                'golden': 'Punto de Oro',
                'advantage': 'Con Ventaja'
            };

            const countingMethodTypes = {
                'players': 'Modo Jugadores',
                'referee': 'Modo Árbitro'
            };

            const sideChangeTypes = {
                'odd': 'Juegos impares',
                'set': 'Final de set',
                'none': 'Sin cambio'
            };

            // Actualizar cada recuadro por separado
            document.getElementById('teams-summary').innerHTML = `
                <p class="mb-2"><strong>Pareja 1:</strong> ${players.jugador1} / ${players.jugador2}</p>
                <p><strong>Pareja 2:</strong> ${players.jugador3} / ${players.jugador4}</p>
            `;

            document.getElementById('format-summary').innerHTML = `
                <p class="mb-2"><strong>Tipo:</strong> ${gameTypeText}</p>
                <p><strong>Puntuación:</strong> ${scoringTypes[config.scoring] || 'No seleccionado'}</p>
                <p><strong>Cambio lado:</strong> ${sideChangeTypes[config.sideChange] || 'No seleccionado'}</p>
            `;
        }


        function startMatch() {
        closeConfirmModal(); // Cierra el modal

        // 1. Recopilamos datos (Igual que antes)
        const players = {
            jugador1: document.getElementById('jugador1').value.trim(),
            jugador2: document.getElementById('jugador2').value.trim(),
            jugador3: document.getElementById('jugador3').value.trim(),
            jugador4: document.getElementById('jugador4').value.trim()
        };

        if (!players.jugador1 || !players.jugador2 || !players.jugador3 || !players.jugador4) {
            alert('Por favor, completa todos los nombres de los jugadores.');
            return;
        }

        // Recuperar si es modo torneo
        const tournamentEl = document.getElementById('tournamentMode');
        const isTournament = tournamentEl ? tournamentEl.checked : false;

        // 2. Preparamos el PAQUETE DE DATOS (JSON) para Internet
        const payload = {
            a_first: players.jugador1,
            a_last: players.jugador2,
            b_first: players.jugador3,
            b_last: players.jugador4,
            gameType: config.gameType,
            scoring: config.scoring,
            sideChange: config.sideChange,
            tournamentMode: isTournament
        };

        // 3. INTENTO 1: ENVIAR POR INTERNET (MQTT)
        // Si estamos conectados a la nube, enviamos por ahí (funciona con 4G/5G)
        const sentViaInternet = mqttSendConfig(payload);

        if (sentViaInternet) {
            setTimeout(() => {
                alert('☁️ ¡Configuración enviada por Internet!\n\nEl marcador debería actualizarse en unos segundos.');
            }, 500);
            return; // ¡Éxito! No hace falta intentar por WiFi local
        }

        // 4. INTENTO 2: FALLBACK LOCAL (WiFi Directo)
        // Si falló el internet, asumimos que estás conectado al WiFi "PadelBoard_AP"
        console.log("⚠️ Falló MQTT, intentando vía local (192.168.4.1)...");

        const params = new URLSearchParams();
        params.append('a_first', players.jugador1);
        params.append('a_last', players.jugador2);
        params.append('b_first', players.jugador3);
        params.append('b_last', players.jugador4);
        params.append('gameType', config.gameType);
        params.append('scoring', config.scoring);
        params.append('sideChange', config.sideChange);
        params.append('tournamentMode', isTournament);

        const apiUrl = `http://192.168.4.1/api/names?${params.toString()}`;

        fetch(apiUrl, { mode: 'no-cors' }) 
            .then(() => {
                setTimeout(() => {
                    alert('📡 Enviado por WiFi Local.\n\n(Asegúrate de estar conectado a la red PadelBoard_AP)');
                }, 100);
            })
            .catch(error => {
                console.error('Error total:', error);
                alert(`❌ ERROR DE CONEXIÓN\n\nNo se pudo enviar ni por Internet ni por WiFi Local.\n\n1. Revisa tu conexión a internet.\n2. O conéctate al WiFi del marcador.`);
            });
    }

    function resetConfig() {
            // El reseteo ahora vuelve a los valores por defecto, no a vacío
            config = {
                players: {},
                gameType: '3sets',
                scoring: 'golden',
                sideChange: 'set'
            };

            document.getElementById('configuracionForm').reset();
            document.getElementById('customGames').value = '';
 
            // Resetear Tipo de Juego (Tarjeta Resumen)
            document.getElementById('game-type-summary-title').textContent = 'Al mejor de 3';
            document.getElementById('game-type-summary-desc').textContent = 'Formato clásico (por defecto)';
            
            document.querySelectorAll('#scoring-golden, #scoring-advantage').forEach(btn => {
                btn.classList.remove('selected');
            });
            document.getElementById('scoring-golden').classList.add('selected');
            
            document.querySelectorAll('#side-odd, #side-set, #side-none').forEach(btn => {
                btn.classList.remove('selected');
            });
            document.getElementById('side-set').classList.add('selected');

            updateSummary();
        }

        function openConfirmModal(event) {
            document.body.classList.add('modal-open');
            event.preventDefault(); // Evita que el formulario se envíe

            // 1. Recopilamos y validamos
            const players = {
                jugador1: document.getElementById('jugador1').value.trim(),
                jugador2: document.getElementById('jugador2').value.trim(),
                jugador3: document.getElementById('jugador3').value.trim(),
                jugador4: document.getElementById('jugador4').value.trim()
            };

            if (!players.jugador1 || !players.jugador2 || !players.jugador3 || !players.jugador4) {
                alert('Por favor, completa todos los nombres de los jugadores.');
                return;
            }
            if (!config.gameType || !config.scoring || !config.sideChange) {
                alert('Por favor, completa toda la configuración del partido.');
                return;
            }

            // 2. Si todo está bien, actualiza el resumen y muestra el modal
            updateSummary(); // Asegura que el resumen esté actualizado
            document.getElementById('confirmModal').classList.remove('hidden');
        }

        function closeConfirmModal() {
            document.body.classList.remove('modal-open');
            document.getElementById('confirmModal').classList.add('hidden');
        }

        // Funciones de navegación
        function switchTab(tabName) {
            // Ocultar todas las secciones
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });

            // Remover clase activa de todos los tabs
            document.querySelectorAll('[id^="tab-"]').forEach(tab => {
                tab.classList.remove('tab-active');
                tab.classList.add('tab-inactive');
            });

            // Mostrar la sección seleccionada
            document.getElementById(`${tabName}-tab`).classList.add('active');
            
            // Activar el tab correspondiente
            document.getElementById(`tab-${tabName}`).classList.remove('tab-inactive');
            document.getElementById(`tab-${tabName}`).classList.add('tab-active');
        }

        // Funciones de navegación de estadísticas
        function showFullStats() {
            // Crear el contenido del historial completo con todas las estadísticas avanzadas
            const fullStatsContent = `
                <!-- Historial Completo de Estadísticas -->
                <div class="mb-8">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">Historial Completo de Estadísticas</h2>
                        <button onclick="showBasicStats()" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg text-sm transition-colors">
                            Volver al Resumen
                        </button>
                    </div>
                </div>

                <!-- Estadísticas del Último Partido -->
                <div class="mb-8">
                    <h3 class="text-xl font-bold text-gray-800 mb-6 text-center">
                        Estadísticas del Último Partido
                    </h3>
                    <div class="grid md:grid-cols-3 gap-6">
                        <div class="bg-gradient-to-r from-blue-50 to-blue-100 rounded-xl p-6 text-center">
                            <h4 class="text-2xl font-bold text-blue-800 mb-2">1h 23min</h4>
                            <p class="text-blue-600 font-medium">Duración Total</p>
                        </div>
                        <div class="bg-gradient-to-r from-blue-50 to-blue-100 rounded-xl p-6 text-center">
                            <h4 class="text-2xl font-bold text-blue-800 mb-2">156</h4>
                            <p class="text-blue-600 font-medium">Puntos Totales</p>
                        </div>
                        <div class="bg-gradient-to-r from-blue-50 to-blue-100 rounded-xl p-6 text-center">
                            <h4 class="text-2xl font-bold text-blue-800 mb-2">7 puntos</h4>
                            <p class="text-blue-600 font-medium">Racha Máxima</p>
                        </div>
                    </div>
                </div>

                <!-- Estadísticas Básicas -->
                <div class="mb-8">
                    <h3 class="text-xl font-bold text-gray-800 mb-6 text-center">
                        Estadísticas Básicas
                    </h3>
                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="bg-white rounded-xl p-6 border-2 border-gray-200">
                            <h4 class="text-lg font-bold text-blue-900 mb-4 text-center">Duración por Set</h4>
                            <div class="space-y-3">
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700">Set 1 (6-4)</span>
                                    <span class="font-bold text-gray-800">38 min</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700">Set 2 (6-2)</span>
                                    <span class="font-bold text-gray-800">28 min</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700">Tiempo por game</span>
                                    <span class="font-bold text-gray-800">4.2 min</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700">Tiempo entre puntos</span>
                                    <span class="font-bold text-gray-800">18 seg</span>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white rounded-xl p-6 border-2 border-gray-200">
                            <h4 class="text-lg font-bold text-blue-900 mb-4 text-center">Puntos por Pareja</h4>
                            <div class="space-y-3">
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700">Juan & Pedro</span>
                                    <span class="font-bold text-gray-800">89 puntos (57%)</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700">Carlos & Ana</span>
                                    <span class="font-bold text-gray-800">67 puntos (43%)</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700">Efectividad ganadores</span>
                                    <span class="font-bold text-gray-800">72%</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700">Puntos consecutivos máx</span>
                                    <span class="font-bold text-gray-800">7 (Juan & Pedro)</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Estadísticas Avanzadas (ESP32) -->
                <div class="mb-8">
                    <h3 class="text-xl font-bold text-gray-800 mb-6 text-center">
                        Estadísticas Avanzadas
                    </h3>
                    <!-- Ritmo de Juego y Efectividad Crítica en una fila -->
                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="bg-white rounded-xl p-6 border-2 border-gray-200">
                            <h4 class="text-lg font-bold text-blue-900 mb-4 text-center">Ritmo de Juego</h4>
                            <div class="space-y-3">
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700">Tiempo entre puntos</span>
                                    <span class="font-bold text-gray-800">18 seg</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700">Pareja más rápida</span>
                                    <span class="font-bold text-gray-800">Juan & Pedro</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700">Velocidad promedio</span>
                                    <span class="font-bold text-gray-800">15 seg/punto</span>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white rounded-xl p-6 border-2 border-gray-200">
                            <h4 class="text-lg font-bold text-blue-900 mb-4 text-center">Efectividad Crítica</h4>
                            <div class="space-y-3">
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700">Break points ganados</span>
                                    <span class="font-bold text-gray-800">3/5 (60%)</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700">Tie-breaks</span>
                                    <span class="font-bold text-gray-800">0/2 sets</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700">Recuperaciones</span>
                                    <span class="font-bold text-gray-800">2 remontadas</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Patrones Avanzados de Juego -->
                <div class="mb-8">
                    <h3 class="text-xl font-bold text-gray-800 mb-6 text-center">
                        Patrones Avanzados de Juego
                    </h3>
                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="bg-white rounded-xl p-6 border-2 border-gray-200">
                            <h4 class="text-lg font-bold text-blue-900 mb-4 text-center">Distribución de Puntos</h4>
                            <div class="space-y-3">
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700">Games dominantes (6-0, 6-1)</span>
                                    <span class="font-bold text-gray-800">25%</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700">Games disputados (6-4, 7-5)</span>
                                    <span class="font-bold text-gray-800">60%</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700">Games cerrados (7-6)</span>
                                    <span class="font-bold text-gray-800">15%</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700">Puntos por game promedio</span>
                                    <span class="font-bold text-gray-800">6.8 puntos</span>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white rounded-xl p-6 border-2 border-gray-200">
                            <h4 class="text-lg font-bold text-blue-900 mb-4 text-center">Velocidad de Juego</h4>
                            <div class="space-y-3">
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700">Juan & Pedro (rápidos)</span>
                                    <span class="font-bold text-gray-800">14 seg/punto</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700">Carlos & Ana (lentos)</span>
                                    <span class="font-bold text-gray-800">22 seg/punto</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700">Puntos por game promedio</span>
                                    <span class="font-bold text-gray-800">6.8 puntos</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700">Frecuencia tie-breaks</span>
                                    <span class="font-bold text-gray-800">15% partidos</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Patrones de Jugadores -->
                <div class="mb-8">
                    <h3 class="text-xl font-bold text-gray-800 mb-6 text-center">
                        Patrones de Jugadores
                    </h3>
                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="bg-white rounded-xl p-6 border-2 border-gray-200">
                            <h4 class="text-lg font-bold text-blue-900 mb-4 text-center">Química de Parejas</h4>
                            <div class="space-y-3">
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700">Juan & Pedro</span>
                                    <span class="font-bold text-gray-800">78% efectividad</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700">María & Luis</span>
                                    <span class="font-bold text-gray-800">65% efectividad</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700">Adaptabilidad</span>
                                    <span class="font-bold text-gray-800">Alta</span>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white rounded-xl p-6 border-2 border-gray-200">
                            <h4 class="text-lg font-bold text-blue-900 mb-4 text-center">Rivalidades</h4>
                            <div class="space-y-3">
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700">vs Carlos & Ana</span>
                                    <span class="font-bold text-gray-800">4-1 (80%)</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700">vs Sofia & Diego</span>
                                    <span class="font-bold text-gray-800">2-3 (40%)</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700">Competitividad</span>
                                    <span class="font-bold text-gray-800">Media-Alta</span>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- Patrones Competitivos -->
                <div class="mb-8">
                    <h3 class="text-xl font-bold text-gray-800 mb-6 text-center">
                        Patrones Competitivos
                    </h3>
                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="bg-white rounded-xl p-6 border-2 border-gray-200">
                            <h4 class="text-lg font-bold text-blue-900 mb-4 text-center">Remontadas y Dominio</h4>
                            <div class="space-y-3">
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700">Remontadas épicas</span>
                                    <span class="font-bold text-gray-800">3 este mes</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700">Primeros sets ganados</span>
                                    <span class="font-bold text-gray-800">18/24 (75%)</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700">Racha ganadora actual</span>
                                    <span class="font-bold text-gray-800">4 partidos</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700">Racha más larga</span>
                                    <span class="font-bold text-gray-800">7 partidos</span>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white rounded-xl p-6 border-2 border-gray-200">
                            <h4 class="text-lg font-bold text-blue-900 mb-4 text-center">Resistencia Mental</h4>
                            <div class="space-y-3">
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700">Rendimiento bajo presión</span>
                                    <span class="font-bold text-gray-800">82%</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700">Momentos críticos ganados</span>
                                    <span class="font-bold text-gray-800">15/20 (75%)</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700">Factor sorpresa</span>
                                    <span class="font-bold text-gray-800">Medio</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700">Efectividad en tie-breaks</span>
                                    <span class="font-bold text-gray-800">4/6 (67%)</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Análisis de Rendimiento -->
                <div class="mb-8">
                    <h3 class="text-xl font-bold text-gray-800 mb-6 text-center">
                        Análisis de Rendimiento
                    </h3>
                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="bg-white rounded-xl p-6 border-2 border-gray-200">
                            <h4 class="text-lg font-bold text-blue-900 mb-4 text-center">Curva de Aprendizaje</h4>
                            <div class="space-y-3">
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700">Mejora mensual</span>
                                    <span class="font-bold text-gray-800">+8%</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700">Tendencia victorias</span>
                                    <span class="font-bold text-gray-800">Ascendente</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700">Progreso técnico</span>
                                    <span class="font-bold text-gray-800">Notable</span>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white rounded-xl p-6 border-2 border-gray-200">
                            <h4 class="text-lg font-bold text-blue-900 mb-4 text-center">Puntos de Quiebre</h4>
                            <div class="space-y-3">
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700">Momentos decisivos</span>
                                    <span class="font-bold text-gray-800">89% ganados</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700">Break points</span>
                                    <span class="font-bold text-gray-800">12/18 (67%)</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700">Efectividad</span>
                                    <span class="font-bold text-gray-800">Muy Alta</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Historial Completo de Partidos -->
                <div class="mb-8">
                    <h3 class="text-xl font-bold text-gray-800 mb-6 text-center">Historial Completo de Partidos</h3>
                    <div class="bg-white rounded-xl p-6 border-2 border-gray-200">
                        <div class="space-y-4">
                            <div class="flex justify-between items-center p-4 bg-green-50 rounded-lg border-l-4 border-green-500">
                                <div>
                                    <span class="font-bold text-gray-800">Juan & Pedro vs Carlos & Ana</span>
                                    <p class="text-sm text-gray-600">Hace 2 días - Club Deportivo • Duración: 1h 23min</p>
                                    <p class="text-xs text-green-600">Victoria • Remontada en 2º set • 7 puntos consecutivos</p>
                                </div>
                                <span class="font-bold text-green-600 text-lg">6-4, 6-2</span>
                            </div>
                            <div class="flex justify-between items-center p-4 bg-red-50 rounded-lg border-l-4 border-red-500">
                                <div>
                                    <span class="font-bold text-gray-800">María & Luis vs Sofia & Diego</span>
                                    <p class="text-sm text-gray-600">Hace 5 días - Polideportivo Norte • Duración: 1h 45min</p>
                                    <p class="text-xs text-red-600">Derrota • Tie-break perdido • Partido muy disputado</p>
                                </div>
                                <span class="font-bold text-red-600 text-lg">4-6, 3-6</span>
                            </div>
                            <div class="flex justify-between items-center p-4 bg-green-50 rounded-lg border-l-4 border-green-500">
                                <div>
                                    <span class="font-bold text-gray-800">Alex & Carmen vs Roberto & Elena</span>
                                    <p class="text-sm text-gray-600">Hace 1 semana - Centro Deportivo • Duración: 1h 38min</p>
                                    <p class="text-xs text-green-600">Victoria • Dominio total • 5 break points ganados</p>
                                </div>
                                <span class="font-bold text-green-600 text-lg">7-5, 6-4</span>
                            </div>
                            <div class="flex justify-between items-center p-4 bg-green-50 rounded-lg border-l-4 border-green-500">
                                <div>
                                    <span class="font-bold text-gray-800">Fernando & Ana vs Miguel & Laura</span>
                                    <p class="text-sm text-gray-600">Hace 1 semana - Club Municipal • Duración: 2h 15min</p>
                                    <p class="text-xs text-green-600">Victoria • Remontada épica • Partido de 3 sets</p>
                                </div>
                                <span class="font-bold text-green-600 text-lg">6-3, 4-6, 6-2</span>
                            </div>
                            <div class="flex justify-between items-center p-4 bg-red-50 rounded-lg border-l-4 border-red-500">
                                <div>
                                    <span class="font-bold text-gray-800">Pablo & Carla vs Javier & Marta</span>
                                    <p class="text-sm text-gray-600">Hace 2 semanas - Polideportivo Sur • Duración: 1h 12min</p>
                                    <p class="text-xs text-red-600">Derrota • Partido rápido • Rival superior</p>
                                </div>
                                <span class="font-bold text-red-600 text-lg">2-6, 4-6</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- App Móvil -->
                <div class="mb-8">
                    <div class="bg-gradient-to-r from-blue-50 to-blue-100 rounded-xl p-6 text-center">
                        <div class="mb-4">
                            <svg class="w-16 h-16 mx-auto text-blue-600 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                            </svg>
                            <h3 class="text-xl font-bold text-blue-800 mb-2">PadelBoard Móvil</h3>
                            <p class="text-blue-600 mb-6">Lleva tus partidos contigo. Sincroniza automáticamente tus estadísticas.</p>
                        </div>
                        <button onclick="downloadApp()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-xl transition-colors">
                            Descargar App Móvil
                        </button>
                    </div>
                </div>


            `;

            // Reemplazar el contenido de stats-with-login con el historial completo
            document.getElementById('stats-with-login').innerHTML = fullStatsContent;
        }

        function showBasicStats() {
            // Restaurar el contenido básico de estadísticas
            const basicStatsContent = `
                <!-- Resumen General -->
                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center justify-center">
                        Resumen General
                    </h2>
                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="bg-gradient-to-r from-blue-50 to-blue-100 rounded-xl p-6 text-center">
                            <h3 class="text-3xl font-bold text-blue-800 mb-2">24</h3>
                            <p class="text-blue-600 font-medium">Partidos Jugados</p>
                        </div>
                        <div class="bg-gradient-to-r from-blue-50 to-blue-100 rounded-xl p-6 text-center">
                            <h3 class="text-3xl font-bold text-blue-800 mb-2">67%</h3>
                            <p class="text-blue-600 font-medium">Porcentaje de Victorias</p>
                        </div>
                        <div class="bg-gradient-to-r from-blue-50 to-blue-100 rounded-xl p-6 text-center">
                            <h3 class="text-3xl font-bold text-blue-800 mb-2">1,247</h3>
                            <p class="text-blue-600 font-medium">Puntos Totales</p>
                        </div>
                    </div>
                </div>

                <!-- Estadísticas Detalladas -->
                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center justify-center">
                        Estadísticas Detalladas
                    </h2>
                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="bg-white rounded-xl p-6 border-2 border-gray-200">
                            <h3 class="text-xl font-bold text-gray-800 mb-4">Rendimiento por Set</h3>
                            <div class="space-y-3">
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700">Sets ganados</span>
                                    <span class="font-bold text-blue-600">32</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700">Sets perdidos</span>
                                    <span class="font-bold text-gray-600">16</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700">Porcentaje de sets</span>
                                    <span class="font-bold text-blue-600">67%</span>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white rounded-xl p-6 border-2 border-gray-200">
                            <h3 class="text-xl font-bold text-gray-800 mb-4">Rendimiento por Game</h3>
                            <div class="space-y-3">
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700">Games ganados</span>
                                    <span class="font-bold text-blue-600">156</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700">Games perdidos</span>
                                    <span class="font-bold text-gray-600">98</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700">Porcentaje de games</span>
                                    <span class="font-bold text-blue-600">61%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Historial de Partidos -->
                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center justify-center">
                        Últimos Partidos
                    </h2>
                    <div class="bg-white rounded-xl p-6 border-2 border-gray-200">
                        <div class="space-y-4">
                            <div class="flex justify-between items-center p-4 bg-gray-50 rounded-lg">
                                <div>
                                    <span class="font-bold text-gray-800">Juan & Pedro vs Carlos & Ana</span>
                                    <p class="text-sm text-gray-600">Hace 2 días - Club Deportivo</p>
                                </div>
                                <span class="font-bold text-green-600 text-lg">6-4, 6-2</span>
                            </div>
                            <div class="flex justify-between items-center p-4 bg-gray-50 rounded-lg">
                                <div>
                                    <span class="font-bold text-gray-800">María & Luis vs Sofia & Diego</span>
                                    <p class="text-sm text-gray-600">Hace 5 días - Polideportivo Norte</p>
                                </div>
                                <span class="font-bold text-red-600 text-lg">4-6, 3-6</span>
                            </div>
                            <div class="flex justify-between items-center p-4 bg-gray-50 rounded-lg">
                                <div>
                                    <span class="font-bold text-gray-800">Alex & Carmen vs Roberto & Elena</span>
                                    <p class="text-sm text-gray-600">Hace 1 semana - Centro Deportivo</p>
                                </div>
                                <span class="font-bold text-green-600 text-lg">7-5, 6-4</span>
                            </div>
                        </div>
                    </div>
                </div>



                <!-- Botón Ver Más -->
                <div class="text-center">
                    <button onclick="showFullStats()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-8 rounded-xl text-lg transition-colors">
                        Ver Historial Completo
                    </button>
                </div>
            `;

            document.getElementById('stats-with-login').innerHTML = basicStatsContent;
        }

        // Funciones de autenticación
        function showLoginForm() {
            document.getElementById('profile-no-login').classList.add('hidden');
            document.getElementById('user-profile').classList.add('hidden');
            document.getElementById('register-form').classList.add('hidden');
            document.getElementById('login-form').classList.remove('hidden');
        }

        function showRegisterForm() {
            document.getElementById('profile-no-login').classList.add('hidden');
            document.getElementById('user-profile').classList.add('hidden');
            document.getElementById('login-form').classList.add('hidden');
            document.getElementById('register-form').classList.remove('hidden');
        }

        function handleLogin(event) {
            event.preventDefault();
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            // Simulación de login (en la app real sería una llamada al servidor)
            if (email && password) {
                isLoggedIn = true;
                currentUser = {
                    name: email.split('@')[0].charAt(0).toUpperCase() + email.split('@')[0].slice(1),
                    email: email,
                    initials: email.charAt(0).toUpperCase() + (email.split('@')[0].charAt(1) || 'U').toUpperCase()
                };
                
                updateUserProfile();
                updateStatsView();
                showUserProfile();
                
                alert('¡Bienvenido! Has iniciado sesión correctamente.');
            }
        }

        function handleRegister(event) {
            event.preventDefault();
            
            const name = document.getElementById('reg-name').value;
            const email = document.getElementById('reg-email').value;
            const password = document.getElementById('reg-password').value;
            
            if (password.length < 6) {
                alert('La contraseña debe tener al menos 6 caracteres');
                return;
            }
            
            // Simulación de registro (en la app real sería una llamada al servidor)
            if (name && email && password) {
                isLoggedIn = true;
                currentUser = {
                    name: name,
                    email: email,
                    initials: name.split(' ').map(n => n.charAt(0)).join('').toUpperCase().substring(0, 2)
                };
                
                updateUserProfile();
                updateStatsView();
                showUserProfile();
                
                alert('¡Cuenta creada exitosamente! Bienvenido a PadelBoard.');
            }
        }

        function showUserProfile() {
            document.getElementById('profile-no-login').classList.add('hidden');
            document.getElementById('login-form').classList.add('hidden');
            document.getElementById('register-form').classList.add('hidden');
            document.getElementById('user-profile').classList.remove('hidden');
        }

        function updateUserProfile() {
            if (currentUser) {
                document.getElementById('user-initials').textContent = currentUser.initials;
                document.getElementById('user-name').textContent = currentUser.name;
                document.getElementById('user-email').textContent = currentUser.email;
            }
        }

        function handleLogout() {
            isLoggedIn = false;
            currentUser = null;
            updateStatsView();
            
            // Mostrar directamente el formulario de login
            document.getElementById('user-profile').classList.add('hidden');
            document.getElementById('register-form').classList.add('hidden');
            document.getElementById('profile-no-login').classList.add('hidden');
            document.getElementById('login-form').classList.remove('hidden');
            
            alert('Sesión cerrada correctamente');
        }

        function updateStatsView() {
            if (isLoggedIn) {
                document.getElementById('stats-no-login').classList.add('hidden');
                document.getElementById('stats-with-login').classList.remove('hidden');
            } else {
                document.getElementById('stats-no-login').classList.remove('hidden');
                document.getElementById('stats-with-login').classList.add('hidden');
            }
        }

        // === INICIALIZACIÓN MODIFICADA ===
        document.addEventListener('DOMContentLoaded', function() {
            mqttConnect(); // (Inicia la conexión a la nube)
            updateStatsView();
            
            // Mostrar contenido apropiado según el estado de login
            if (!isLoggedIn) {
                document.getElementById('login-form').classList.remove('hidden');
                document.getElementById('profile-no-login').classList.add('hidden');
                document.getElementById('user-profile').classList.add('hidden');
                document.getElementById('register-form').classList.add('hidden');
            }
            
            document.querySelectorAll('input[type="text"]').forEach(input => {
                input.addEventListener('input', updateSummary);
            });

            // Seleccionar las opciones por defecto al cargar la página
            document.getElementById('scoring-golden').classList.add('selected');
            document.getElementById('side-set').classList.add('selected');
            
            // Actualizar el resumen con los valores por defecto
            updateSummary();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98c0e80030e0824f',t:'MTc2MDA0NDY2Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();
</script>
</body>
</html>